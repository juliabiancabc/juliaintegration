<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Calendar - BridgeGen</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('events.static', filename='calendar/css/calendar_bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('events.static', filename='calendar/css/calendar_style.css') }}">
    
    <style>
        /* REUSED CORE STYLES FROM COMMUNITY.HTML */
        :root { --primary-color: #5b5FEF; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { min-height: 100vh; display: flex; flex-direction: column; }
        header { display: flex; align-items: center; justify-content: space-between; padding: 15px 40px; background: white; border-bottom: 1px solid #eee; height: 70px;}
        .logo { font-size: 24px; color: var(--primary-color); }
        .nav-links { display: flex; gap: 30px; }
        .nav-links a { text-decoration: none; color: #444; font-weight: 500; font-size: 14px; }
        .nav-links a:hover { color: var(--primary-color); }
        
        /* CALENDAR SPECIFIC STYLES */
        .page-header { display: flex; justify-content: space-between; align-items: center; margin: 30px 40px; }
        .calendar-layout { display: flex; gap: 30px; padding: 0 40px 40px 40px; }
        .calendar-section { flex: 1; background: white; border-radius: 10px; padding: 20px; }
        .events-section { flex: 1; }
        .event-list { display: flex; flex-direction: column; gap: 15px; }
        .calendar-event { border-left: 4px solid #667eea; padding: 15px; background: #f8f9ff; border-radius: 8px; }
        .event-date-badge { background: #667eea; color: white; padding: 8px 12px; border-radius: 6px; display: inline-block; margin-bottom: 10px; font-weight: 600; font-size: 12px; }
        .event-details h3 { margin-bottom: 8px; color: #333; font-size: 16px; }
        .event-meta { color: #666; margin-bottom: 6px; font-size: 13px; }
        .no-events { text-align: center; padding: 40px; background: #f8f9ff; border-radius: 10px; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; text-decoration: none; display: inline-block; font-size: 13px; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-primary:hover { background: #4a4ed0; }
        /* Remove scrollbar from calendar container */
        .calendar-section,
        .calendar,
        .frame {
            overflow: hidden !important;
        }

    </style>
</head>
<body>
    <header>
    <div class="logo">
        <a href="/" style="color:inherit; text-decoration:none;">
            <i class="fa-solid fa-asterisk"></i>
        </a>
    </div>
    
    <div class="input-group input-group-sm" style="width: 200px; margin-left: 20px;">
        <span class="input-group-text bg-light border-0">
            <i class="fa-solid fa-search text-muted"></i>
        </span>
        <input type="text" class="form-control bg-light border-0" placeholder="Search">
    </div>
    
    <nav class="nav-links">
        <a href="/">Home</a>
        <a href="/messaging/home">Messaging</a>
        <a href="/stories">LazarusStories</a>
        <a href="/events/list" style="color: var(--primary-color);">Events</a>
        <a href="/community">Community</a>
        {% if session.user_type == 'moderator' %}
            <a href="/stories/gamification/admin">Badges</a>
        {% else %}
            <a href="/stories/gamification/catalog">Badges</a>
        {% endif %}
    </nav>
    
    <div style="display: flex; align-items: center; gap: 15px;">
        <a href="#" style="text-decoration: none; color: #444; font-size: 14px;">FAQ</a>
        
        {% if session.user_id %}
            {% if session.user_type == 'moderator' %}
                <a href="/moderator/dashboard" class="btn btn-outline-secondary btn-sm px-3 d-flex align-items-center gap-2">
                    <i class="fa-solid fa-shield"></i> {{ session.full_name or 'staff' }}
                </a>
            {% else %}
                <a href="/profile" class="btn btn-outline-secondary btn-sm px-3 d-flex align-items-center gap-2">
                    <i class="fa-solid fa-user"></i> {{ session.full_name or 'User' }}
                </a>
            {% endif %}
            
            <a href="/logout" class="btn btn-outline-danger btn-sm px-3">
                <i class="fa-solid fa-right-from-bracket"></i> Logout
            </a>
        {% endif %}
    </div>
</header>

    <div class="page-header">
        <div>
            <h1>My Calendar üìÜ</h1>
            <p style="color: #666;">Events you've registered for</p>
        </div>
        <a href="/events/list" class="btn btn-secondary">‚Üê Back</a>
    </div>

    <div class="calendar-layout">
        <div class="calendar-section">
            <div class="calendar">
                <div class="year-header">
                    <span class="left-button fa fa-chevron-left" id="prev"> </span>
                    <span class="year" id="label"></span>
                    <span class="right-button fa fa-chevron-right" id="next"> </span>
                </div>
                <table class="months-table w-100">
                    <tbody>
                        <tr class="months-row">
                            <td class="month">Jan</td><td class="month">Feb</td><td class="month">Mar</td>
                            <td class="month">Apr</td><td class="month">May</td><td class="month">Jun</td>
                            <td class="month">Jul</td><td class="month">Aug</td><td class="month">Sep</td>
                            <td class="month">Oct</td><td class="month">Nov</td><td class="month">Dec</td>
                        </tr>
                    </tbody>
                </table>
                <table class="days-table w-100">
                    <td class="day">Sun</td><td class="day">Mon</td><td class="day">Tue</td>
                    <td class="day">Wed</td><td class="day">Thu</td><td class="day">Fri</td>
                    <td class="day">Sat</td>
                </table>
                <div class="frame">
                    <table class="dates-table w-100">
                        <tbody class="tbody"></tbody>
                    </table>
                </div>
            </div>
            <div class="events-container"></div>
        </div>

        <div class="events-section">
            <h3 style="margin-bottom: 20px;">My Registered Events</h3>
            {% if events %}
            <div class="event-list">
                {% for event in events %}
                <div class="calendar-event">
                    <div class="event-date-badge">{{ event['date'] }}</div>
                    <div class="event-details">
                        <h3>{{ event['title'] }}</h3>
                        <div class="event-meta"><strong>üìç</strong> {{ event['location'] }}</div>
                        <div class="event-meta"><strong>üìù</strong> {{ event['category']|title if event['category'] else 'General' }}</div>
                        <p style="margin-top: 10px; color: #666; font-size: 13px;">{{ event['description'] }}</p>
                    </div>
                    <div style="margin-top: 10px;">
                        <form method="POST" action="/events/unregister/{{ event['id'] }}" style="display: inline;">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to unregister?');">Unregister</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="no-events">
                <div style="font-size: 48px; margin-bottom: 15px;">üìÖ</div>
                <h3>No Events Yet</h3>
                <p>You haven't registered for any events.</p>
                <a href="/events/browse" class="btn btn-primary" style="margin-top: 15px;">Browse Events</a>
            </div>
            {% endif %}
        </div>
    </div>

    <script src="{{ url_for('events.static', filename='calendar/js/jquery.min.js') }}"></script>
    <script src="{{ url_for('events.static', filename='calendar/js/popper.js') }}"></script>
    <script src="{{ url_for('events.static', filename='calendar/js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('events.static', filename='calendar/js/main.js') }}"></script>
    <script>
    $(document).ready(function() {
        // Get registered event dates
        var registeredDates = [
            {% for event in events %}
            "{{ event['date'] }}"{% if not loop.last %},{% endif %}
            {% endfor %}
        ];
        
        // Highlight registered dates after calendar loads
        setTimeout(function() {
            registeredDates.forEach(function(dateStr) {
                var date = new Date(dateStr);
                var day = date.getDate();
                $('.dates-table .tbody td').each(function() {
                    if ($(this).text() == day && !$(this).hasClass('nil')) {
                        $(this).css({
                            'background-color': '#667eea',
                            'color': 'white',
                            'font-weight': 'bold',
                            'border-radius': '50%'
                        });
                    }
                });
            });
        }, 500);
    });
    </script>
</body>
</html>
