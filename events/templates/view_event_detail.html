{% extends "events_base.html" %}
{% block title %}Event Details{% endblock %}
{% block content %}
<style>
    body { background: white !important; }
    .container { background: white !important; padding: 0 !important; max-width: 100% !important; margin: 0 !important; }
    .page-layout { display: flex; height: calc(100vh - 80px); overflow: hidden; }
    .sidebar { width: 180px; background: #5B4FE9; padding: 25px 15px; }
    .sidebar-title { color: white; font-size: 13px; margin-bottom: 18px; font-weight: 600; }
    .sidebar-item { color: white; padding: 10px 12px; margin-bottom: 6px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 12px; }
    .sidebar-item.active { background: rgba(255,255,255,0.2); }
    .main-area { flex: 1; padding: 25px 35px; overflow-y: auto; background: white; }
    .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .section-title { font-size: 18px; color: #5B4FE9; font-weight: 600; display: flex; align-items: center; gap: 10px; }
    .back-btn { background: #E0E0E0; color: #333; padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; text-decoration: none; }
    .button-group { display: flex; gap: 10px; }
    .save-button { background: #5B4FE9; color: white; padding: 8px 25px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; }
    .cancel-button { background: #DC3545; color: white; padding: 8px 25px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; text-decoration: none; display: inline-block; }
    .event-image-box { width: 100%; height: 140px; background: #E8E8E8; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #999; margin-bottom: 15px; }
    .section-label { font-size: 12px; font-weight: 600; margin-bottom: 8px; color: #333; }
    .description-box { width: 100%; height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: inherit; font-size: 12px; resize: vertical; }
    .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
    .input-row-three { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 12px; }
    .input-label { font-size: 11px; font-weight: 600; margin-bottom: 5px; color: #333; display: block; }
    .input-field { width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 12px; }
    .input-field:focus { outline: none; border-color: #5B4FE9; }
</style>

<div class="page-layout">
    <div class="sidebar">
        <div class="sidebar-title">Event Navigation</div>
        <a href="{{ url_for('manage_events') }}" class="sidebar-item {% if request.endpoint in ['manage_events', 'create_event', 'view_event_detail', 'edit_event'] %}active{% endif %}" style="text-decoration: none;">
    <span>üìã</span>
    <span>Manage Events</span>
</a>
<a href="{{ url_for('attendee_insights') }}" class="sidebar-item {% if request.endpoint == 'attendee_insights' %}active{% endif %}" style="text-decoration: none;">
    <span>üìä</span>
    <span>Attendee Insights</span>
</a>
    </div>

    <div class="main-area">
        <div class="top-bar">
            <div class="section-title">
                <a href="{{ url_for('manage_events') }}" class="back-btn">‚Üê</a>
                <span>Event Details</span>
            </div>
            <div class="button-group">
                <button type="submit" form="editEventForm" class="save-button">Save</button>
                <a href="{{ url_for('delete_event', event_id=event.id) }}" class="cancel-button" 
                   onclick="return confirm('Are you sure you want to delete this event?')">Delete</a>
            </div>
        </div>

        <form method="POST" action="{{ url_for('update_event_detail', event_id=event.id) }}" id="editEventForm" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="">

            <label for="imageUpload" class="event-image-box" style="cursor: pointer; position: relative; overflow: hidden;">
    <input type="file" id="imageUpload" name="image" accept="image/*" onchange="previewImage(event)" style="display: none;">
    {% if event and event.image_filename %}
    <img id="imagePreview" src="{{ url_for('static', filename='uploads/' + event.image_filename) }}" style="width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0;">
    <div id="uploadPrompt" style="display: none;">
    {% else %}
    <img id="imagePreview" style="display: none; width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0;">
    <div id="uploadPrompt">
    {% endif %}
        <div class="upload-icon">üì∑</div>
        <div class="upload-text">Click to upload</div>
    </div>
</label>

            <div style="margin-bottom: 12px;">
                <div class="section-label">Event Description</div>
                <textarea name="description" class="description-box">{{ event.description }}</textarea>
            </div>

            <div class="input-row">
                <div>
                    <label class="input-label">Event Name</label>
                    <input type="text" name="title" class="input-field" value="{{ event.title }}">
                </div>
                <div>
                    <label class="input-label">Event Date</label>
                    <input type="date" name="date" class="input-field" value="{{ event.date.strftime('%Y-%m-%d') if event else '' }}" required>
                </div>
            </div>

            <div class="input-row">
                <div>
                    <label class="input-label">Event Venue</label>
                    <input type="text" name="location" class="input-field" value="{{ event.location }}">
                </div>
                <div>
                    <label class="input-label">Event Time</label>
                    <input type="time" name="event_time" class="input-field" value="{{ event.date.strftime('%H:%M') }}">
                </div>
            </div>

            <div class="input-row">
                <div>
                    <label class="input-label">Capacity</label>
                    <input type="number" name="seat_amount" class="input-field" value="{{ event.seat_amount or '' }}" required>
                </div>
                
                
            </div>

            <div class="input-row">
                <div>
                    <label class="input-label">Tags</label>
                    <input type="text" name="tags" class="input-field" value="{{ event.tags or '' }}">
                </div>
                <div>
                    <label class="input-label">Expected Attendance</label>
                    <input type="number" name="expected_attendance" class="input-field" value="{{ event.expected_attendance or 50 }}">
                </div>
            </div>

            <div class="input-row">
                <div>
                    <label class="input-label">Event Type</label>
                    <select name="event_type" class="input-field">
                        <option value="physical" {% if event.event_type == 'physical' %}selected{% endif %}>Physical</option>
                        <option value="virtual" {% if event.event_type == 'virtual' %}selected{% endif %}>Virtual</option>
                    </select>
                </div>
                <div>
                    <label class="input-label">Category</label>
                    <select name="category" class="input-field">
                        <option value="social" {% if event.category == 'social' %}selected{% endif %}>Social</option>
                        <option value="health" {% if event.category == 'health' %}selected{% endif %}>Health & Wellness</option>
                        <option value="education" {% if event.category == 'education' %}selected{% endif %}>Education</option>
                        <option value="sports" {% if event.category == 'sports' %}selected{% endif %}>Sports & Recreation</option>
                        <option value="arts" {% if event.category == 'arts' %}selected{% endif %}>Arts & Culture</option>
                    </select>
                </div>
            </div>
        </form>
    </div>
</div>
<script>
function previewImage(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('imagePreview').src = e.target.result;
            document.getElementById('imagePreview').style.display = 'block';
            document.getElementById('uploadPrompt').style.display = 'none';
        }
        reader.readAsDataURL(file);
    }
}
</script>
{% endblock %}
