{% extends "events_base.html" %}
{% block title %}Browse Events{% endblock %}
{% block content %}
<style>
    body { background: white !important; }
    .container { background: white !important; padding: 0 !important; max-width: 100% !important; margin: 0 !important; }
    .page-layout { display: flex; min-height: calc(100vh - 80px); }
    .main-area { flex: 1; padding: 30px 40px; background: white; }
    .header { font-size: 22px; font-weight: 600; margin-bottom: 25px; color: #5B4FE9; }
    .toolbar { display: flex; gap: 15px; margin-bottom: 25px; align-items: center; }
    .search-box { padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; width: 200px; font-size: 13px; }
    .filter-dropdown { padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; }
    .section-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .section-label { font-size: 16px; font-weight: 600; }
    .legend { display: flex; gap: 20px; }
    .legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; }
    .dot { width: 8px; height: 8px; border-radius: 50%; }
    .dot-blue { background: #5B4FE9; }
    .dot-yellow { background: #FFC107; }
    .dot-gray { background: #9E9E9E; }
    .events-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
    .event-card { background: white; border: 1px solid #E0E0E0; border-radius: 10px; overflow: hidden; }
    .event-img { height: 140px; background: #E8E8E8; display: flex; align-items: center; justify-content: center; color: #999; font-size: 12px; }
    .event-body { padding: 16px; }
    .event-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
    .spaces { font-size: 12px; color: #666; margin-bottom: 12px; }
    .event-info { font-size: 11px; color: #666; margin-bottom: 3px; }
    .view-btn { width: 100%; padding: 8px; background: white; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-size: 12px; margin-top: 12px; display: flex; align-items: center; justify-content: center; gap: 6px; text-decoration: none; color: inherit; }
    .view-btn:hover { background: #F8F9FF; border-color: #5B4FE9; }
    .registered-badge { background: #28a745; color: white; padding: 8px; border-radius: 6px; font-size: 12px; margin-top: 12px; text-align: center; }
    .back-btn { font-size: 24px; color: #5B4FE9; text-decoration: none; }
</style>

<div class="page-layout">
    <div class="main-area">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <a href="{{ url_for('user_dashboard') }}" class="back-btn" style="text-decoration: none;">‚Üê </a>
                <span>Browse Events</span>
            </div>
        </div>

        <div class="toolbar">
            <input type="text" id="searchBox" class="search-box" placeholder="Search events..." onkeyup="filterEvents()">
            <select id="typeFilter" class="filter-dropdown" onchange="filterEvents()">
                <option value="all">All Types</option>
                <option value="physical">Physical</option>
                <option value="virtual">Virtual</option>
            </select>
            <select id="sortFilter" class="filter-dropdown" onchange="sortEvents()" style="margin-left: auto;">
                <option value="latest">Latest Events</option>
                <option value="oldest">Oldest Events</option>
            </select>
        </div>

        <div class="section-bar">
            <div class="section-label">All Events</div>
            <div class="legend">
                <div class="legend-item"><div class="dot dot-blue"></div><span>Virtual</span></div>
                <div class="legend-item"><div class="dot dot-yellow"></div><span>Physical</span></div>
            </div>
        </div>

        {% if events %}
        <div class="events-grid">
            {% for event in events %}
            <div class="event-card" data-date="{{ event.date.strftime('%Y-%m-%d') }}">
                <div class="event-img">
                    {% if event.image_filename %}
                    <img src="{{ url_for('static', filename='uploads/' + event.image_filename) }}" style="width: 100%; height: 100%; object-fit: cover;">
                    {% else %}
                    Event Image
                    {% endif %}
                </div>
                <div class="event-body">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                        <div class="dot {% if event.event_type == 'virtual' %}dot-blue{% else %}dot-yellow{% endif %}"></div>
                        <div class="event-title">{{ event.title }}</div>
                    </div>
                    <div class="spaces">üìÖ {{ event.available_capacity }}/{{ event.seat_amount or 70 }} spaces left</div>
                    <div class="event-info event-venue">Venue: {{ event.location }}</div>
                    <div class="event-info event-date">Date: {{ event.date.strftime('%d %B %Y') }}</div>
                    <div class="event-info event-time">Time: {{ event.date.strftime('%I:%M%p') }}</div>
                    
                    {% if event.id in registered_event_ids %}
                        <div class="registered-badge">‚úì Already Registered</div>
                    {% else %}
                        <a href="{{ url_for('user_event_detail', event_id=event.id) }}" class="view-btn">
                            <span>üëÅ</span><span>View & Register</span>
                        </a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; padding: 60px; color: #999;">
            <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>
            <h3>No Events Available</h3>
            <p>Check back later for upcoming events!</p>
        </div>
        {% endif %}
    </div>
</div>

<script>
function filterEvents() {
    const search = document.getElementById('searchBox').value.toLowerCase();
    const typeFilter = document.getElementById('typeFilter').value;
    const cards = document.querySelectorAll('.event-card');

    cards.forEach(card => {
        const title = card.querySelector('.event-title');
        const venue = card.querySelector('.event-venue');
        
        if (!title || !venue) return;
        
        const titleText = title.textContent.toLowerCase();
        const venueText = venue.textContent.toLowerCase();
        const eventType = card.querySelector('.dot').classList.contains('dot-blue') ? 'virtual' : 'physical';

        const matchesSearch = titleText.includes(search) || venueText.includes(search);
        const matchesType = typeFilter === 'all' || typeFilter === eventType;

        card.style.display = (matchesSearch && matchesType) ? 'block' : 'none';
    });
}

function sortEvents() {
    const sortBy = document.getElementById('sortFilter').value;
    const grid = document.querySelector('.events-grid');
    const cards = Array.from(document.querySelectorAll('.event-card'));

    if (!grid || cards.length === 0) return;

    cards.sort((a, b) => {
        const dateA = new Date(a.getAttribute('data-date'));
        const dateB = new Date(b.getAttribute('data-date'));

        if (sortBy === 'latest') {
            return dateB - dateA;
        } else {
            return dateA - dateB;
        }
    });

    grid.innerHTML = '';
    cards.forEach(card => grid.appendChild(card));
}
</script>
{% endblock %}
