{% extends 'stories_base.html' %}

{% block title %}{% if achievement %}Edit Achievement{% else %}Create Achievement{% endif %}{% endblock %}

{% block content %}
<div class="container py-4">
    <h2 class="text-primary mb-4">{% if achievement %}Edit Achievement{% else %}Create Achievement{% endif %}</h2>
    <a href="{{ url_for('stories.gamification.admin_achievements_list') }}" class="btn btn-link mb-3">← Back to Achievements</a>
    <form method="post" class="max-w-500">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="mb-3">
            <label for="title" class="form-label">Title *</label>
            <input type="text" name="title" id="title" class="form-control" value="{{ achievement.title if achievement else '' }}" required>
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea name="description" id="description" class="form-control" rows="2">{{ achievement.description if achievement else '' }}</textarea>
        </div>
        <div class="mb-3">
            <label for="rule_type" class="form-label">Rule type *</label>
            <select name="rule_type" id="rule_type" class="form-select" required>
                <option value="">— Select —</option>
                {% for rt in rule_types %}
                <option value="{{ rt }}" {% if achievement and achievement.rule_type == rt %}selected{% endif %}>{{ rt }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="rule_value" class="form-label">Rule value (N in &ge; N) *</label>
            <input type="number" name="rule_value" id="rule_value" class="form-control" value="{{ achievement.rule_value if achievement else 1 }}" min="1" required>
        </div>
        <div class="mb-3">
            <div class="form-check">
                <input type="checkbox" name="active" id="active" class="form-check-input" value="1" {% if not achievement or achievement.active %}checked{% endif %}>
                <label for="active" class="form-check-label">Active</label>
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">Badges awarded (select one or more)</label>
            {% for b in badges %}
            <div class="form-check">
                <input type="checkbox" name="badge_ids" id="badge_{{ b.id }}" class="form-check-input" value="{{ b.id }}" {% if achievement and b.id in achievement.badge_ids %}checked{% endif %}>
                <label for="badge_{{ b.id }}" class="form-check-label">{{ b.title }} (#{{ b.id }})</label>
            </div>
            {% else %}
            <p class="text-muted small">No badges yet. <a href="{{ url_for('stories.gamification.admin_badge_create') }}">Create badges</a> first.</p>
            {% endfor %}
        </div>
        <button type="submit" class="btn btn-primary">{% if achievement %}Update{% else %}Create{% endif %} Achievement</button>
    </form>
</div>
{% endblock %}
