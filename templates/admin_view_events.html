{% extends "base.html" %}
{% block title %}Manage Events{% endblock %}
{% block content %}
<style>
    body { background: white !important; }
    .container { background: white !important; padding: 0 !important; max-width: 100% !important; margin: 0 !important; }
    .page-layout { display: flex; min-height: calc(100vh - 80px); }
    .sidebar { width: 200px; background: #5B4FE9; padding: 30px 20px; }
    .sidebar-title { color: white; font-size: 14px; margin-bottom: 20px; font-weight: 600; }
    .sidebar-item { color: white; padding: 10px 12px; margin-bottom: 8px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 13px; }
    .sidebar-item.active { background: rgba(255,255,255,0.2); }
    .main-area { flex: 1; padding: 30px 40px; background: white; }
    .header { font-size: 22px; font-weight: 600; margin-bottom: 25px; color: #5B4FE9; }
    .toolbar { display: flex; gap: 15px; margin-bottom: 25px; align-items: center; }
    .new-event-btn { background: #5B4FE9; color: white; padding: 8px 18px; border: none; border-radius: 6px; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; font-size: 13px; }
    .search-box { padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; width: 200px; font-size: 13px; }
    .filter-dropdown { padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; }
    .section-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .section-label { font-size: 16px; font-weight: 600; }
    .legend { display: flex; gap: 20px; }
    .legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; }
    .dot { width: 8px; height: 8px; border-radius: 50%; }
    .dot-blue { background: #5B4FE9; }
    .dot-yellow { background: #FFC107; }
    .dot-gray { background: #9E9E9E; }
    .events-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
    .event-card { background: white; border: 1px solid #E0E0E0; border-radius: 10px; overflow: hidden; }
    .event-img { height: 140px; background: #E8E8E8; display: flex; align-items: center; justify-content: center; color: #999; font-size: 12px; }
    .event-body { padding: 16px; }
    .event-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
    .spaces { font-size: 12px; color: #666; margin-bottom: 12px; }
    .event-info { font-size: 11px; color: #666; margin-bottom: 3px; }
    .view-btn { width: 100%; padding: 8px; background: white; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-size: 12px; margin-top: 12px; display: flex; align-items: center; justify-content: center; gap: 6px; }
    .view-btn:hover { background: #F8F9FF; border-color: #5B4FE9; }
</style>

<div class="page-layout">
    <div class="sidebar">
        <div class="sidebar-title">Event Navigation</div>
<a href="{{ url_for('manage_events') }}" class="sidebar-item {% if request.endpoint in ['manage_events', 'create_event', 'view_event_detail', 'edit_event'] %}active{% endif %}" style="text-decoration: none;">
    <span>üìã</span>
    <span>Manage Events</span>
</a>
<a href="{{ url_for('attendee_insights') }}" class="sidebar-item {% if request.endpoint == 'attendee_insights' %}active{% endif %}" style="text-decoration: none;">
    <span>üìä</span>
    <span>Attendee Insights</span>
</a>
    </div>
    <div class="main-area">
        <div class="header">Event Management Section</div>
        
        <div class="toolbar">
            <a href="{{ url_for('create_event') }}" class="new-event-btn">
                <span>+</span>
                <span>New Event</span>
            </a>
            <select class="filter-dropdown">
                <option>Attendee Insights</option>
            </select>
            <input type="text" class="search-box" placeholder="Search..." id="searchBox">
            <select class="filter-dropdown" id="sortDropdown" style="margin-left: auto;" onchange="window.location.href='{{ url_for('admin_view_events') }}?sort=' + this.value">
                <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>Newest Events</option>
                <option value="oldest" {% if sort_by == 'oldest' %}selected{% endif %}>Oldest Events</option>
                <option value="title" {% if sort_by == 'title' %}selected{% endif %}>Title (A-Z)</option>
            </select>
            <button class="filter-dropdown" style="background: white; cursor: pointer;">üìÖ Pick Date</button>
        </div>

        <div class="section-bar">
            <div class="section-label">All Events</div>
            <div class="legend">
                <div class="legend-item"><div class="dot dot-blue"></div><span>Virtual</span></div>
                <div class="legend-item"><div class="dot dot-yellow"></div><span>Physical</span></div>
                <div class="legend-item"><div class="dot dot-gray"></div><span>Closed Events</span></div>
            </div>
        </div>

        {% if events %}
        <div class="events-grid">
            {% for event in events %}
            <div class="event-card">
                <div class="event-img">Event Image</div>
                <div class="event-body">
                    <div class="event-title" style="display: flex; align-items: center; gap: 6px;">
                        {% if event.event_type == 'virtual' %}
                            <div class="dot dot-blue"></div>
                        {% elif event.is_closed %}
                            <div class="dot dot-gray"></div>
                        {% else %}
                            <div class="dot dot-yellow"></div>
                        {% endif %}
                        {{ event.title }}
                    </div>
                    <div class="spaces">
                        {% if event.event_type == 'virtual' %}
                            üîµ {{ event.available_capacity }}/{{ event.seat_amount }} spaces left
                        {% else %}
                            üìÖ {{ event.available_capacity }}/{{ event.seat_amount }} spaces left
                        {% endif %}
                    </div>
                    <div class="event-info">Venue: {{ event.location }}</div>
                    <div class="event-info">Date: {{ event.date.strftime('%d %B %Y') }}</div>
                    <div class="event-info">Time: {{ event.date.strftime('%I:%M%p') }}</div>
                    <a href="{{ url_for('view_event_detail', event_id=event.id) }}" class="view-btn" style="text-decoration: none; color: inherit;">
                        <span>üëÅ</span><span>View</span>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; padding: 60px; color: #999;">
            <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>
            <h3>No Events Yet</h3>
            <p>Create your first event!</p>
        </div>
        {% endif %}
    </div>
</div>

<script>
// Handle search functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchBox = document.getElementById('searchBox');
    if (searchBox) {
        searchBox.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const eventCards = document.querySelectorAll('.event-card');
            
            eventCards.forEach(card => {
                const title = card.querySelector('.event-title').textContent.toLowerCase();
                const location = card.querySelector('.event-info').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || location.includes(searchTerm)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    }
});
</script>
{% endblock %}
